# AI Coding Assistant Instructions for Monsieur Sens

## Project Architecture

This is a **Bedrock-based WordPress site** (secure, modern WordPress structure) with a Timber-based theme. The project uses Composer for PHP dependency management at the Bedrock root level and Bud (webpack wrapper) for JavaScript/CSS asset bundling within the theme. This is a marketing showcase site (not e-commerce) featuring flexible ACF content sections.

### Key Directory Structure
- **`/`** - Bedrock root with `config/`, `vendor/`, and `web/` (WordPress lives here)
- **`config/`** - Environment-specific configurations (development.php, staging.php)
- **`web/`** - WordPress installation directory
- **`web/app/themes/monsieur-sens/`** - Main custom theme using Timber + Tailwind CSS
- **`web/app/plugins/`** - Plugins directory (ACF Pro, Yoast SEO, etc.)
- **`web/wp/`** - WordPress core (do not modify)

### Theme Directory Structure
```
web/app/themes/monsieur-sens/
├── src/                    # PHP classes (StarterSite.php)
├── views/                  # Twig templates
│   ├── base.twig          # Main layout wrapper
│   ├── front-page.twig    # Homepage blueprint
│   ├── page.twig          # Default page template (with ACF flex sections)
│   ├── page-contact.twig  # Contact page
│   ├── page-suggestions.twig # Suggestions page
│   ├── single.twig        # Single post template
│   ├── archive.twig       # Archive/listing template
│   ├── footer.twig        # Footer component
│   ├── header.twig        # Header (minimal, extends base)
│   ├── html-header.twig   # HTML <head> tag
│   ├── menu.twig          # Navigation menu
│   └── partial/           # Reusable Twig components
│       └── pagination.twig
├── static/                # Source assets
│   ├── js/                # JavaScript source files
│   │   └── app.js         # Main entry point
│   ├── css/               # CSS source files (Tailwind)
│   │   └── app.css        # Main CSS entry
│   ├── fonts/             # Custom fonts
│   └── img/               # Images
├── dist/                  # Compiled assets (do not edit directly, generated by Bud)
├── functions.php          # Theme bootstrap
├── bud.config.js          # Bud/Webpack configuration
├── tailwind.config.js     # Tailwind CSS configuration
├── composer.json          # Theme-specific dependencies (PHP)
├── package.json           # Node.js dependencies (Tailwind, Bud)
└── 404.php, page.php, front-page.php, etc. # Minimal PHP routers to Twig
```

## Core Tech Stack

- **PHP 8.1+** with modern type hints and strict standards
- **Bedrock** - Secure WordPress structure by Roots
- **Timber 2.3+** - Twig templating layer for WordPress (NOT pure WordPress templating)
- **Bud 6.20+** - Asset bundler (Webpack wrapper) with Tailwind CSS and PostCSS
- **Tailwind CSS** - Utility-first CSS framework (no Flowbite)
- **ACF Pro** - Advanced Custom Fields for custom fields and flexible content
- **Swiper 11+** - Touch slider library for carousels and galleries
- **GSAP 3+** - Animation library for advanced motion design
- **Yoast SEO** - SEO optimization
- **WP Mail SMTP** - Email delivery
- **Loco Translate** - In-app translation management

## Critical Patterns & Conventions

### Theme Structure (Timber-based)
- All template rendering happens through **Twig templates** in `views/`
- PHP files like `page.php`, `front-page.php` are minimal routers to Twig via Timber
- **Context** is populated in `StarterSite::add_to_context()` in [src/StarterSite.php](web/app/themes/monsieur-sens/src/StarterSite.php)
- **Menus** are retrieved via `Timber::get_menu()` and passed to context
- Post types and taxonomies registered in `StarterSite::register_post_types()` and `register_taxonomies()`
- **No admin bar** displayed to frontend users

### Template Hierarchy
- `base.twig` - Main layout wrapper with header/footer structure
- `page.twig` - Default page template with ACF flexible content sections
- `front-page.twig` - Homepage with custom hero and sections
- `page-contact.twig` - Contact form page
- `page-suggestions.twig` - Suggestions/feedback page
- `single.twig` - Single post template
- `archive.twig` - Archive/listing template
- `footer.twig` - Footer content
- `html-header.twig` - HTML `<head>` tag and meta tags
- `menu.twig` - Navigation menu rendering
- `partial/` - Reusable Twig components

### Asset Compilation
- **Entry point**: `static/js/app.js` and `static/css/app.css` (defined in [bud.config.js](web/app/themes/monsieur-sens/bud.config.js))
- **Build output**: `dist/` directory (served from `/app/themes/monsieur-sens/dist/`)
- **Dev server**: `http://localhost:3000` proxied to `http://monsieursens.local` (with polling)
- **Watches**: `static/js`, `static/css`, `views` with 1000ms polling interval

### Code Style
- **Text domain**: `monsieur-sens` (for translations)
- **Theme name**: Monsieur Sens
- **PHP standard**: PSR-4 autoloading via Composer
- **JavaScript**: ES6 modules, no transpiling needed (modern browsers)
- **CSS**: Tailwind utility-first approach, no @apply directive

## Essential Workflows

### Composer Dependencies (at Bedrock root)
```bash
composer install           # Install PHP dependencies (Timber, ACF, plugins)
composer update           # Update dependencies
composer dump-autoload    # Regenerate autoloader
```

### Theme Dependencies & Development (in theme directory)
```bash
cd web/app/themes/monsieur-sens
yarn install              # Install Node dependencies (Bud, Tailwind)
yarn dev                  # Watch mode for CSS/JS with hot reload
yarn build               # Production build of assets
```

### WordPress Admin & CLI
```bash
# From Bedrock root with WP-CLI installed
wp post list              # List posts
wp plugin list            # List active plugins
wp theme activate monsieur-sens  # Activate theme
```

## Integration Points

### Installed Plugins
- **Advanced Custom Fields Pro** - Custom fields and flexible content sections
- **Yoast SEO** - SEO optimization and sitemaps
- **WP Mail SMTP** - Reliable email delivery
- **Loco Translate** - In-app translation management
- **W3 Total Cache** - Performance optimization
- **EWWW Image Optimizer** - Image optimization
- **WordPress Core in a subdirectory** - Security enhancement (web/wp)

### Critical Hooks & Filters
- `after_setup_theme` - Theme setup, theme supports, registers menus
- `init` - Register custom post types and taxonomies (MUST use init, not after_setup_theme)
- `wp_enqueue_scripts` - Load scripts/styles
- `timber/context` - Add variables available in all Twig templates
- `timber/twig` - Add custom Twig functions/filters
- `show_admin_bar` - Hidden from frontend (via filter `__return_false`)

## Common Tasks

### Creating a Custom Page Template
1. Create `page-{slug}.php` in theme root (minimal router):
   ```php
   <?php
   // e.g., page-contact.php
   $context = Timber::context();
   Timber::render('page-contact.twig', $context);
   ```
2. Create `views/page-{slug}.twig` with template logic
3. Use `base.twig` as layout wrapper:
   ```twig
   {% extends "base.twig" %}
   {% block content %}
     <!-- Page content -->
   {% endblock %}
   ```

### Building Flexible ACF Section Pages
1. In WordPress admin, create an **ACF Flexible Content field** named `sections` on the Page post type
2. Add layout rows (e.g., "Hero Section", "Features Grid", "CTA Block")
3. In `page.twig`, loop through layouts:
   ```twig
   {% if post.get_field('sections') %}
     {% for row in post.get_field('sections') %}
       {% if row.acf_fc_layout == 'hero_section' %}
         {% include 'partial/hero-section.twig' with {section: row} %}
       {% elseif row.acf_fc_layout == 'features_grid' %}
         {% include 'partial/features-grid.twig' with {section: row} %}
       {% endif %}
     {% endfor %}
   {% endif %}
   ```
4. Create corresponding partials in `views/partial/`

### Adding Swiper Carousel
1. Install Swiper (usually pre-installed via package.json)
2. In JavaScript (`static/js/app.js` or a module):
   ```javascript
   import Swiper from 'swiper';
   import { Navigation, Pagination } from 'swiper/modules';

   Swiper.use([Navigation, Pagination]);

   const swiper = new Swiper('.swiper', {
     modules: [Navigation, Pagination],
     slidesPerView: 1,
     pagination: { el: '.swiper-pagination' },
     navigation: {
       nextEl: '.swiper-button-next',
       prevEl: '.swiper-button-prev',
     },
     breakpoints: {
       768: { slidesPerView: 3 },
     },
   });
   ```
3. In Twig template:
   ```twig
   <div class="swiper">
     <div class="swiper-wrapper">
       {% for item in items %}
         <div class="swiper-slide">{{ item.title }}</div>
       {% endfor %}
     </div>
     <div class="swiper-pagination"></div>
     <div class="swiper-button-prev"></div>
     <div class="swiper-button-next"></div>
   </div>
   ```

### Adding GSAP Animations
1. Import GSAP in your JavaScript:
   ```javascript
   import gsap from 'gsap';
   import { ScrollTrigger } from 'gsap/ScrollTrigger';

   gsap.registerPlugin(ScrollTrigger);

   // Animate elements on scroll
   gsap.to('.fade-in-element', {
     scrollTrigger: {
       trigger: '.fade-in-element',
       start: 'top center',
     },
     duration: 1,
     opacity: 1,
     y: 0,
   });
   ```
2. In Twig, add [data-gsap] attributes to animate:
   ```twig
   <div class="fade-in-element opacity-0" data-gsap="fadeInUp">
     Content to animate
   </div>
   ```

### Modifying Styles
1. Add CSS to `static/css/` directory or edit `static/css/app.css`
2. Use Tailwind classes in Twig templates
3. For custom CSS, use `static/css/custom.css` and import it in `app.css`:
   ```css
   @import 'custom.css';
   ```
4. Run `yarn dev` for watch mode

### Creating a Twig Partial
1. Create file in `views/partial/` (e.g., `partial/card.twig`)
2. Include in templates:
   ```twig
   {% include 'partial/card.twig' with {data: myData, title: 'Hello'} %}
   ```
3. Access passed variables in the partial:
   ```twig
   <div class="card">
     <h3>{{ title }}</h3>
     <p>{{ data.description }}</p>
   </div>
   ```

### Adding JavaScript Modules
1. Create/edit files in `static/js/` (e.g., `static/js/modules/slider.js`)
2. Import in `static/js/app.js`:
   ```javascript
   import { initSlider } from './modules/slider.js';

   document.addEventListener('DOMContentLoaded', () => {
     initSlider();
   });
   ```
3. Use ES6 modules syntax

### Setup ACF Pro Fields
1. In WordPress admin, go to ACF > Custom Fields
2. Define fields at post type or specific page level (e.g., Contact Page)
3. Common field types:
   - **Text/Textarea** - Basic text
   - **Flexible Content** - Dynamic sections (most used for page.twig)
   - **Repeater** - Multiple rows of data (galleries, team members)
   - **Image** - Single image upload
   - **Gallery** - Multiple images
   - **URL/Email/Phone** - Specific input types
4. Access in Twig:
   ```twig
   {{ post.get_field('field_name') }}
   ```

## Directory Organization Best Practices

### Static Assets Organization
```
static/
├── js/
│   ├── app.js              # Main entry, imports all modules
│   ├── modules/
│   │   ├── slider.js       # Swiper carousel initialization
│   │   ├── animations.js   # GSAP animations
│   │   └── forms.js        # Form handling
│   └── utils/
│       └── helpers.js      # Utility functions
├── css/
│   ├── app.css             # Main entry, imports all features
│   ├── base.css            # Reset/base styles
│   ├── typography.css      # Font and text styles
│   ├── components.css      # Custom component styles
│   └── animations.css      # Custom animation utilities
└── img/
    ├── logo.svg            # Logo and brand assets
    ├── icons/              # SVG icons
    └── backgrounds/        # Background images
```

### Views Organization
```
views/
├── base.twig               # Layout wrapper
├── front-page.twig         # Homepage
├── page.twig               # Default page (flexible ACF)
├── page-contact.twig       # Contact page
├── page-suggestions.twig   # Suggestions page
├── single.twig             # Single post
├── archive.twig            # Archive listing
├── footer.twig             # Footer content
├── html-header.twig        # <head> tag
├── menu.twig               # Navigation menu
└── partial/                # Reusable components
    ├── header-hero.twig    # Hero section
    ├── features-grid.twig  # Features grid
    ├── cta-block.twig      # Call-to-action
    ├── testimonial.twig    # Testimonial card
    ├── case-study.twig     # Case study preview
    └── pagination.twig     # Pagination controls
```

## Configuration & Environment

### Bedrock Environment Variables
- Edit `.env` or `config/environments/{environment}.php`
- Key variables:
  - `WP_ENV` - 'development', 'staging', or 'production'
  - `WP_DEBUG` - Enable debug mode (development only)
  - `WP_DEBUG_LOG` - Log errors to `wp-content/debug.log`
  - `SCRIPT_DEBUG` - Load unminified JS/CSS (development)

### WordPress Configuration
- Managed in `web/wp-config.php` (auto-generated by Bedrock)
- Custom settings in `config/application.php`

## Important Notes

- **DO NOT** edit `web/wp/` - WordPress core files
- **DO NOT** edit `dist/` directly - it's generated by Bud
- **DO NOT** use @apply in Tailwind CSS - it can bloat output, use classes instead
- **Timber first**: Always use Twig templates, not raw PHP template tags
- **Internationalization**: Use `{{ __('string', 'monsieur-sens') }}` in Twig or `__('string', 'monsieur-sens')` in PHP
- **No Flowbite**: Use custom Tailwind + Swiper for UI components and carousels
- **Swiper over pure CSS**: For complex carousels and sliders, use Swiper with touch support
- **GSAP for complex animations**: Use GSAP for scroll-triggered and timeline animations
- **ACF is standard**: All custom fields must use ACF, no hardcoded values
- **Security**: Bedrock structure keeps wp-config.php outside web root - maintain this
- **Use Composer autoload**: All custom PHP classes should follow PSR-4 in `src/`
- **Dev URLs**: Local dev at `monsieursens.local` via Bud proxy

## File Naming Conventions

| Type | Location | Naming |
|------|----------|--------|
| PHP Page Templates | `theme root` | `{template}.php`, `page-{slug}.php`, `front-page.php` |
| Twig Templates | `views/` | `{template}.twig`, `page-{slug}.twig`, `front-page.twig` |
| Twig Partials | `views/partial/` | `{component}.twig` (e.g., `hero-section.twig`) |
| CSS Files | `static/css/` | `{feature}.css`, imported in `app.css` |
| JavaScript Modules | `static/js/modules/` | `{feature}.js`, imported in `app.js` |
| PHP Classes | `src/` | `{ClassName}.php` (PSR-4 style) |
| ACF Flexible Layouts | Twig partials | `{layout-name}.twig` (kebab-case) |

## Quick Reference: Building with ACF Flexible Content

Most of the site uses **ACF Flexible Content** on `page.twig`. Here's the pattern:

1. **Create ACF layouts in WordPress** (e.g., "hero_section", "features_grid")
2. **Build Twig partials** for each layout:
   ```twig
   {# views/partial/hero-section.twig #}
   <section class="hero py-20 bg-gradient-to-r from-blue-600 to-purple-600">
     <div class="container mx-auto">
       <h1 class="text-4xl font-bold text-white">{{ section.title }}</h1>
       <p class="text-xl text-gray-100">{{ section.subtitle }}</p>
     </div>
   </section>
   ```
3. **Reference in page.twig**:
   ```twig
   {% for row in post.get_field('sections') %}
     {% if row.acf_fc_layout == 'hero_section' %}
       {% include 'partial/hero-section.twig' with {section: row} %}
     {% endif %}
   {% endfor %}
   ```

This gives a flexible, component-based architecture that's easy to maintain and scale.

## Page Blueprints

### Front Page (`front-page.twig`)
- Hero banner with GSAP animations
- Feature highlights with icons
- Testimonials carousel (Swiper)
- Call-to-action section
- Latest blog posts

### Contact Page (`page-contact.twig`)
- Contact form (ACF forms or custom)
- Contact information (address, phone, email)

### Default Page (`page.twig`)
- Featured image (optional)
- ACF flexible content sections
- Sidebar (conditional)

## Debugging & Support

### Enable Debug Mode
```php
// In config/environments/development.php
define('WP_DEBUG',     true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

### Check Compiled Assets
- Ensure `yarn dev` is running or `yarn build` has been executed
- Assets should be in `dist/` subdirectories
- Verify [bud.config.js](web/app/themes/monsieur-sens/bud.config.js) paths match

### Timber Context
- View context vars in any Twig template: `{{ dump(post) }}`
- Check `StarterSite::add_to_context()` for globally available vars

