{% extends "base.twig" %}

{% block content %}
	<div
		class="container max-w-7xl mx-auto px-4">

		{# Hero : carrousel pleine largeur avec titre, sous-titre et deux boutons #}
		{% set hero = post.meta('hero_accueil')|default({}) %}
		{% set images = hero.images_hero|default([]) %}

		<section
			class="hero-section relative">
			{# voile violet sombre entre les slides et le contenu #}
			<div class="hero-veil absolute inset-0 bg-[rgba(0,0,0,0.5)] pointer-events-none z-10"></div>
			<div class="swiper hero-swiper">
				<div class="swiper-wrapper">
					{% for img in images %}
						<div class="swiper-slide">
							<img src="{{ img.url }}" alt="{{ img.alt|default('') }}" class="w-full object-cover h-[80vh] rounded-3xl"/>
						</div>
					{% endfor %}
				</div>
				<div class="swiper-pagination"></div>
			</div>

			<div class="hero-overlay absolute inset-0 flex items-center justify-center z-20">
				<div class="text-center text-white max-w-2xl px-4">
					<h1 class="text-6xl font-display mb-4">{{ hero.titre_hero|default('Titre principal') }}</h1>
					<p class="mb-6 text-2xl">{{ hero.sous_titre_hero|default('Sous-titre descriptif') }}</p>
					<div class="space-x-4">
						{% set btn_inverse = 'inline-block bg-black text-ms-white py-2 px-6 rounded-lg font-semibold border-2 border-ms-gold hover:bg-ms-gold hover:text-black transition duration-300' %}
						{% set btn_contact = 'inline-block bg-ms-gold text-black py-2 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-white hover:border-ms-gold transition duration-300' %}
						{% for btn in hero.boutons_hero|default([]) %}
							{% set label = btn.texte_bouton|default(btn.bouton_text|default(btn.texte|default(btn.titre|default('')))) %}
							{% set href = btn.lien_bouton|default(btn.bouton_url|default(btn.lien|default('#'))) %}
							{% set btn_classes = (loop.index == 1) ? btn_inverse : btn_contact %}
							<a href="{{ href }}" class="{{ btn_classes }}" aria-label="{{ label }}">{{ label }}</a>
						{% endfor %}
					</div>
				</div>
			</div>
		</section>


		{# Bloc suggestions : 4 images avec titre et bordure gold #}
		{% set suggestions = suggestions|default(post.meta('bloc_suggestions')|default([])) %}

		<section id="suggestions" class="container max-w-5xl mx-auto -translate-y-10 relative z-20">
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
				{% for s in suggestions %}
					{# compute anchor from slug, fall back to groupless link #}
					{% set anchor = s.slug ? ('#' ~ s.slug) : '' %}
					{% set href = suggestions_page_url ~ anchor %}
					<a href="{{ href }}" aria-label="{{ s.titre_suggestion|default('Suggestion') }}" class="block h-full">
						<article class="suggestion-card h-full flex flex-col justify-between border-2 border-ms-gold rounded-tl-3xl rounded-tr-lg rounded-br-3xl rounded-bl-lg overflow-hidden bg-black">
							<div class="flex-grow flex items-center justify-center px-4 py-6 text-white text-center font-display text-2xl">
								<h3 class="font-semibold m-0">{{ s.titre_suggestion|default('') }}</h3>
							</div>
							{% if s.photo_suggestion %}
								<img src="{{ s.photo_suggestion.url }}" alt="{{ s.titre_suggestion|default('') }}" class="w-full h-72 object-cover p-2 rounded-tl-3xl rounded-tr-lg rounded-br-3xl rounded-bl-lg"/>
							{% endif %}
						</article>
					</a>
				{% endfor %}
			</div>
		</section>


		{# Bloc choisir : rendu stylé + tolérance sur noms de champs ACF #}
		{% set choisir = post.meta('bloc_choisir')|default({}) %}
		{% set cards = choisir.card_choisir|default([]) %}

		<section class="py-8 md:py-12">
			<div class="container max-w-7xl mx-auto">
				<div class="relative rounded-tl-3xl rounded-tr-lg rounded-br-3xl rounded-bl-lg overflow-visible border-2 border-ms-gold" style="{{ (choisir.image_choisir is defined and choisir.image_choisir) ? ('background-image: url(' ~ choisir.image_choisir.url ~ '); background-size: cover; background-position: center;') : '' }}">
					<div class="absolute inset-0 bg-black/80 rounded-tl-3xl rounded-tr-lg rounded-br-3xl rounded-bl-lg"></div>
					<div class="relative z-10 p-8">
						<h2 class="text-3xl text-center font-display text-white mb-16">{{ choisir.titre_choisir }}</h2>
						<div class="grid md:grid-cols-3 gap-6 max-w-4xl mx-auto">
							{% for c in cards %}
								{# Résolution souple des noms de champs possibles #}
								{% set img_url = (c.image is defined and c.image) ? c.image.url : ((c.image_choisir is defined and c.image_choisir) ? c.image_choisir.url : ((c.photo is defined and c.photo) ? c.photo.url : '')) %}
								{% set icon_url = (c.icone_card is defined and c.icone_card) ? c.icone_card.url : ((c.icone is defined and c.icone) ? c.icone.url : ((c.icon is defined and c.icon) ? c.icon.url : '')) %}
								{% set title = c.titre_card|default(c.titre|default(c.titre_choisir|default('Titre'))) %}
								{% set text = c.texte_card|default(c.texte|default(c.texte_choisir|default(c.description|default('')))) %}
								{% set btn_text = c.texte_bouton_card|default(c.texte_bouton|default(c.bouton_text|default('En savoir plus'))) %}
								{% set btn_href = c.lien_bouton_card|default(c.lien_bouton|default(c.bouton_url|default(c.lien|default('#')))) %}

								<div class="relative rounded-lg overflow-visible min-h-[280px] bg-black/90 border-2 border-ms-gold p-6 flex flex-col justify-between text-white rounded-tl-3xl rounded-tr-lg rounded-br-3xl rounded-bl-lg">
									<div class="absolute -top-10 left-1/2 transform -translate-x-1/2 z-40">
										<div class="w-20 h-20 rounded-full bg-black border-2 border-ms-gold flex items-center justify-center overflow-hidden">
											{% if icon_url %}
												<img src="{{ icon_url }}" alt="" class="w-12 h-12 object-contain"/>
											{% else %}
												<span class="text-ms-gold">●</span>
											{% endif %}
										</div>
									</div>

									<div class="pt-8 text-center z-10">
										<h3 class="font-semibold text-xl mb-2">{{ title }}</h3>
										<p class="text-md">{{ text }}</p>
									</div>
									<div class="mt-6 text-center z-10">
										<a href="{{ btn_href }}" class="inline-block bg-transparent text-ms-gold py-2 px-4 rounded-lg font-semibold border-2 border-ms-gold hover:bg-ms-gold hover:text-black transition duration-300">{{ btn_text }}</a>
									</div>

									{% if img_url %}
										<div class="absolute inset-0 -z-10 opacity-30">
											<img src="{{ img_url }}" alt="{{ title }}" class="w-full h-full object-cover"/>
										</div>
									{% endif %}
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</section>


		{# Bloc histoire : colonne gauche texte, image à droite #}
		{% set histoire = post.meta('bloc_histoire')|default({}) %}

		<section class="py-12 container grid md:grid-cols-2 gap-8 items-center">
			<div>
				<h2 class="text-2xl mb-4">{{ histoire.titre_histoire|default('Notre histoire') }}</h2>
				<p class="mb-6">{{ histoire.texte_histoire|default('En août 2025, Monsieur Sens voit le jour...') }}</p>
				<a href="{{ histoire.bouton_url|default('#') }}" class="bg-yellow-400 text-black px-4 py-2 rounded">{{ histoire.bouton_text|default('En savoir plus') }}</a>
			</div>
			<div>
				{% if histoire.image_histoire %}
					<img src="{{ histoire.image_histoire.url }}" alt="{{ histoire.titre_histoire|default('') }}" class="w-full rounded-lg object-cover"/>
				{% endif %}
			</div>
		</section>


		{# Bloc engagements : image à gauche, contenu et 3 cards à droite #}
		{% set eng = post.meta('bloc_engagements')|default({}) %}
		{% set eng_cards = eng.card_engagements|default([]) %}

		<section class="py-12 container grid md:grid-cols-2 gap-8 items-start">
			<div>
				{% if eng.image %}
					<img src="{{ eng.image.url }}" alt="{{ eng.titre|default('') }}" class="w-full rounded-lg object-cover"/>
				{% endif %}
			</div>
			<div>
				<h2 class="text-2xl mb-4">{{ eng.titre|default('Nos engagements') }}</h2>
				<p class="mb-6">{{ eng.texte|default('Parce que la cuisine rassemble...') }}</p>
				<div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
					{% for card in eng_cards %}
						<div class="border border-yellow-400 rounded-lg p-4 text-center bg-black/50">
							{% if card.icone %}
								<img src="{{ card.icone.url }}" alt="" class="mx-auto h-10 mb-2"/>
							{% endif %}
							<div class="font-semibold">{{ card.titre|default('') }}</div>
							<div class="text-sm">{{ card.texte|default('') }}</div>
						</div>
					{% endfor %}
				</div>
			</div>
		</section>


		{# Bloc contact : titre, paragraphe, bouton #}
		{% set contact = post.meta('bloc_contact')|default({}) %}

		<section id="contact" class="py-12 container text-center">
			<h2 class="text-2xl mb-4">{{ contact.titre|default('Parlons de votre évènement') }}</h2>
			<p class="mb-6 max-w-2xl mx-auto">{{ contact.texte|default('Prêts à offrir à vos invités une expérience gastronomique hors du commun ?') }}</p>
			<a href="{{ contact.bouton_url|default('/contact') }}" class="bg-yellow-400 text-black px-6 py-3 rounded inline-block">{{ contact.bouton_text|default('Contactez-nous') }}</a>
		</section>


		{# Bloc galerie : 7 images en disposition masonry #}
		{% set gallery = post.meta('bloc_galerie')|default([]) %}

		<section class="py-12 container">
			<div class="columns-3 gap-4 space-y-4">
				{% for img in gallery %}
					<img src="{{ img.url }}" alt="{{ img.alt|default('') }}" class="w-full mb-4 break-inside rounded-lg object-cover"/>
				{% endfor %}
			</div>
		</section>
	</div>
{% endblock %}
