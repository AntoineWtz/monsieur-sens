{% extends "base.twig" %}

{% block content %}

	<div class="container max-w-7xl mx-auto px-4 py-12">
		<header class="text-center mb-12">
			<h1 class="text-4xl md:text-5xl lg:text-6xl font-display uppercase font-bold mb-6 heading-gold-gradient">{{ post.title }}</h1>
			<p class="mt-4 text-lg text-white/70 max-w-3xl mx-auto">{{ sous_titre_suggestions }}</p>
			{# Bouton pour télécharger le menu complet si champ PDF présent #}
			{% if menu_pdf %}
				<div class="mt-8 text-center">
					<a href="{{ menu_pdf.url }}" class="inline-block bg-ms-gold text-black py-2 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-gold hover:border-ms-gold transition duration-300" target="_blank" rel="noopener">{{ __('Télécharger le menu complet', 'awstarter') }}</a>
				</div>
			{% endif %}
		</header>

		{% for group in suggestion_groups %}
			<section class="my-16 rounded-2xl p-6 bg-black/5 ring-1 ring-ms-gold/10">
				{% set posts = group.posts ?: [] %}
				{% set preview = posts|slice(0,4) %}
				{% set rest = posts|slice(4) %}

				<div
					class="md:grid md:grid-cols-3 gap-y-0 gap-6 items-stretch">
					{# If title_left: carousel in first column, preview grid in next two columns; else preview first then carousel in col 3 #}
					{% if group.title_left %}
						<div class="md:col-span-1">
							<h2 class="text-2xl font-semibold text-center">{{ group.title }}</h2>
							<div class="mt-2 mb-7 w-32 h-1 bg-ms-gold mx-auto rounded-full" aria-hidden="true"></div>

							{% if posts and posts|length > 0 %}
								<div class="mt-4 w-full">
									<div class="relative w-full h-60 rounded-2xl overflow-hidden suggestion-rotator" data-interval="3500" role="region" aria-roledescription="carousel" aria-label="{{ group.title }}">
										<div class="absolute inset-0">
											{% for plat in posts %}
												{% if plat.thumbnail %}
													<img src="{{ plat.thumbnail.src }}" data-title="{{ plat.title }}" alt="{{ plat.title }}" loading="lazy" class="rotator-image absolute inset-0 w-full h-full object-cover transition-opacity duration-700 {{ loop.first ? 'opacity-100' : 'opacity-0' }}"/>
												{% endif %}
											{% endfor %}
										</div>
									</div>
								</div>
							{% endif %}
						</div>

						<div class="md:col-span-2">
							{% if preview and preview|length > 0 %}
								<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 auto-rows-[minmax(0,1fr)] items-stretch">
									{% for plat in preview %}
										{% include 'partial/suggestion-plat.twig' with {plat: plat} %}
									{% endfor %}
								</div>
							{% endif %}
						</div>
					{% else %}
						<div class="md:col-span-2">
							{% if preview and preview|length > 0 %}
								<div class="grid grid-cols-1 sm:grid-cols-2 gap-6 auto-rows-[minmax(0,1fr)] items-stretch">
									{% for plat in preview %}
										{% include 'partial/suggestion-plat.twig' with {plat: plat} %}
									{% endfor %}
								</div>
							{% endif %}
						</div>

						<div class="md:col-span-1 md:col-start-3">
							<h2 class="text-2xl font-semibold text-center">{{ group.title }}</h2>
							<div class="mt-2 mb-7 w-32 h-1 bg-ms-gold mx-auto rounded-full" aria-hidden="true"></div>

							{% if posts and posts|length > 0 %}
								<div class="mt-4 w-full">
									<div class="relative w-full h-60 rounded-2xl overflow-hidden suggestion-rotator" data-interval="3500" role="region" aria-roledescription="carousel" aria-label="{{ group.title }}">
										<div class="absolute inset-0">
											{% for plat in posts %}
												{% if plat.thumbnail %}
													<img src="{{ plat.thumbnail.src }}" data-title="{{ plat.title }}" alt="{{ plat.title }}" loading="lazy" class="rotator-image absolute inset-0 w-full h-full object-cover transition-opacity duration-700 {{ loop.first ? 'opacity-100' : 'opacity-0' }}"/>
												{% endif %}
											{% endfor %}
										</div>
									</div>
								</div>
							{% endif %}
						</div>
					{% endif %}

					{# Remaining posts rendered full width below the top row, arranged in three columns to fill available space #}
					<div class="md:col-span-3 mt-6">
						{% if rest and rest|length > 0 %}
							<div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 auto-rows-[minmax(0,1fr)] items-stretch">
								{% for plat in rest %}
									{% include 'partial/suggestion-plat.twig' with {plat: plat} %}
								{% endfor %}
							</div>
						{% elseif not posts or posts|length == 0 %}
							<p class="text-gray-600">{{ __('Aucun élément disponible pour cette section pour le moment.', 'awstarter') }}</p>
						{% endif %}
					</div>
				</div>
			</section>
		{% endfor %}

		{# Plateau repas via ACF: render full-width block if field provided #}
		{% if plateau_repas %}
			<section class="mt-12">
				<div class="rounded-2xl p-8 bg-gradient-to-r from-black/60 to-black/40 ring-1 ring-ms-gold/10 flex flex-col md:flex-row items-center justify-between gap-6">
					<div class="flex-1">
						<h3 class="text-2xl font-display font-semibold text-ms-gold">{{ plateau_repas.title ?: 'Plateau repas' }}</h3>
						{% if plateau_repas.content %}
							<p class="mt-3 text-ms-white/80 max-w-3xl">{{ plateau_repas.content }}</p>
						{% elseif plateau_repas.description %}
							<p class="mt-3 text-ms-white/80 max-w-3xl">{{ plateau_repas.description }}</p>
						{% elseif plateau_repas is not iterable %}
							<p class="mt-3 text-ms-white/80 max-w-3xl">{{ plateau_repas }}</p>
						{% endif %}
					</div>
					<div class="flex-none">
						{% if plateau_repas.cta_url %}
							<a href="{{ plateau_repas.cta_url }}" class="inline-block bg-ms-gold text-black py-3 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-gold hover:border-ms-gold transition duration-300">{{ plateau_repas.cta_label ?: __('Nous contacter', 'awstarter') }}</a>
						{% else %}
							<a href="/contact" class="inline-block bg-ms-gold text-black py-3 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-gold hover:border-ms-gold transition duration-300">{{ __('Nous contacter', 'awstarter') }}</a>
						{% endif %}
					</div>
				</div>
			</section>
		{% endif %}

	</div>

{% endblock %}
