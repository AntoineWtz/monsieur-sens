{# === Contenu flexible ACF — Monsieur Sens (template par défaut) === #}
{% set sections = post.meta('section')|default([]) %}

{% for section in sections %}

	{# 1) SECTION 1 COLONNE (texte / photo / vidéo / diaporama) #}
	{% if section.acf_fc_layout == 'section_1_colonne' %}
		<section class="py-4 lg:py-8">
			<div
				class="container mx-auto px-6">

				{#  TEXTE  #}
				{% if section.type_de_contenu == 'texte' and section.texte %}
					<div class="prose max-w-none text-ms-white whitespace-pre-line">
						{{ section.texte|raw }}
					</div>

					{#  PHOTO  #}
				{% elseif section.type_de_contenu == 'photo' and section.photo %}
					<figure class="overflow-hidden">
						<img src="{{ section.photo.url }}" alt="{{ section.photo.alt|default('') }}" class="w-full h-[300px] md:h-[420px] object-cover rounded-tl-lg rounded-tr-3xl rounded-bl-3xl rounded-br-lg border-2 border-ms-gold" loading="lazy">
					</figure>

					{#  VIDEO (cover + bouton play) #}
				{% elseif section.type_de_contenu == 'video' and section.video and section.video_cover %}
					{% set cover = section.video_cover %}
					<button type="button" class="cw-video-open group relative w-full overflow-hidden focus:outline-none" data-video-url="{{ section.video|trim }}">
						<img src="{{ cover.url }}" alt="{{ cover.alt|default('Vidéo') }}" class="block w-full h-[220px] md:h-[540px] object-cover rounded-tl-3xl rounded-tr-lg rounded-bl-lg rounded-br-3xl" loading="lazy">
						<span class="absolute inset-0 bg-ms-black/25 group-hover:bg-ms-black/35 transition"></span>
						<span class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-ms-white/95 text-ms-black shadow-lg rounded-3xl opacity-90 group-hover:opacity-100 transition" aria-label="Lire la vidéo">
							<i class="fa-solid fa-play text-xl md:text-2xl translate-x-[2px]"></i>
						</span>
					</button>

					{# --- DIAPORAMA -> MASONRY moderne (grid responsive + expansion) --- #}
				{% elseif section.type_de_contenu == 'diaporama' and section.diaporama %}
					{% set imgs = section.diaporama|default([]) %}
					{% if imgs|length %}
						<div class="max-w-6xl mx-auto">

							<div class="ms-masonry" data-masonry>
								<div class="ms-grid">
									{% for img in imgs %}
										{% set full  = (img.sizes.large ?? img.sizes['2048x2048'] ?? img.url) %}
										{% set thumb = (img.sizes.medium_large ?? img.sizes.medium ?? img.url) %}

										<article class="masonry-item" data-full="{{ full }}" data-alt="{{ img.alt|default('') }}">
											<div class="masonry-content">
												<img src="{{ thumb }}" alt="{{ img.alt|default('') }}" loading="lazy" decoding="async" fetchpriority="low">
											</div>
										</article>
									{% endfor %}
								</div>
							</div>

						</div>
					{% endif %}
				{% endif %}


			</div>
		</section>
	{% endif %}

	{#  2) SECTION 2 COLONNES (photo / texte + bouton téléchargement) #}
	{% if section.acf_fc_layout == 'section_2_colonne' %}
		<section class="py-8">
			<div class="container mx-auto px-6 grid lg:grid-cols-2 gap-8 lg:gap-12 items-center">

				{% for side in ['colonne_gauche','colonne_droite'] %}
					{% set content = attribute(section, side) %}

					{# TEXTE #}
					{% if content and content.type_de_contenu == 'texte' %}
						<div class="py-8 lg:py-12">
							<div class="prose max-w-2xl text-ms-white whitespace-pre-line">
								{{ content.texte|raw }}
							</div>

							{% set has_cta = content.cta_label and content.cta_url %}
							{% if has_cta %}
								<div class="mt-5 flex justify-center lg:justify-start">
									{% set _f = content.cta_url %}
									{% set _href  = (_f is defined and _f.url is defined) ? _f.url : _f %}
									{% set _fname = (_f is defined and _f.filename is defined) ? _f.filename : ( (_f is defined and _f.title is defined) ? _f.title : '' ) %}
									{% set _is_download = (_f is defined and _f.url is defined) %}

									{% if _href %}
										<a href="{{ _href }}" {% if _is_download %} download {% if _fname %}="{{ _fname }}" {% endif %} {% endif %} class="inline-block bg-ms-gold text-black py-2 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-gold hover:border-ms-gold transition duration-300" aria-label="{{ content.cta_label }}{% if _fname %} – {{ _fname }}{% endif %}">
											<span>
												{{ content.cta_label }}
											</span>
										</a>
									{% endif %}
								</div>
							{% endif %}
						</div>
					{% endif %}

					{# PHOTO #}
					{% if content and content.type_de_contenu == 'photo' and content.photo %}
						<figure class="overflow-hidden">
							<img src="{{ content.photo.url }}" alt="{{ content.photo.alt|default('') }}" class="block w-full h-[260px] md:h-[420px] object-cover rounded-tl-lg rounded-tr-3xl rounded-bl-3xl rounded-br-lg border-2 border-ms-gold" loading="lazy">
						</figure>
					{% endif %}
				{% endfor %}

			</div>
		</section>
	{% endif %}

	{#  3) FAQ #}
	{% if section.acf_fc_layout == 'faq' %}
		<section class="py-4 lg:py-8">
			<div class="container mx-auto px-6">

				{% if section.faq_groups and section.faq_groups|length %}
					{% for g in section.faq_groups %}
						{% if g.items and g.items|length %}
							<h2 class="font-display text-[48px] text-center mb-4 uppercase">{{ __('FAQ', 'monsieur-sens') }}
							</h2>
							<div class="max-w-4xl mx-auto" data-faq-group>
								{% for it in g.items %}
									<details class="group border-t border-ms-gold/50 first:border-t-0" {{ loop.first ? 'open' }}>
										<summary class="flex items-center gap-3 cursor-pointer select-none py-4 px-5">
											<span class="inline-flex items-center justify-center w-6 h-6 rounded-full text-base font-bold shrink-0 bg-ms-light-black text-ms-white transition-colors group-open:bg-ms-gold group-open:text-ms-black">
												?
											</span>
											<span class="flex-1 font-bold transition-colors text-ms-white group-open:text-ms-white text-xl">
												{{ it.q }}
											</span>
											<span class="ml-4 transition-all text-ms-gold group-open:text-ms-light-black group-open:rotate-180">
												<i class="fa-solid fa-chevron-down"></i>
											</span>
										</summary>
										<div class="px-5 pb-5">
											<div class="pt-4 prose max-w-none text-ms-white text-base font-normal">
												{{ it.a|raw }}
											</div>
										</div>
									</details>
								{% endfor %}
							</div>
						{% endif %}
					{% endfor %}
				{% else %}
					<p class="mt-6 opacity-70 text-center">
						{{ __('Aucune question n’a encore été ajoutée.', 'monsieur-sens') }}
					</p>
				{% endif %}
			</div>
			{# Masque le chevron natif du <summary> (Safari/Chromium) #}
			<style>
				summary::-webkit-details-marker {
					display: none
				}
			</style>

		</section>
	{% endif %}

	{#  4) CHIFFRES CLÉS  #}
	{% if section.acf_fc_layout == 'chiffres_cles' and section.kpis %}
		<section class="py-12 lg:py-16 bg-ms-black">
			<div
				class="mx-auto max-w-7xl px-6">

				{# Titre + déco #}
				{% if section.titre_kpis %}
					<div class="text-center">
						<h2 class="mt-4 font-display tracking-wide text-[28px] lg:text-[47px] text-ms-white">
							{{ section.titre_kpis }}
						</h2>
					</div>
				{% endif %}

				{# Bloc KPIs - Option 2 : Asymétrique hero #}
				<div class="mt-10 text-ms-white px-6">
					<div
						class="grid grid-cols-1 lg:grid-cols-12 gap-2 md:gap-6 items-stretch" data-kpis-hero>

						{# Left: hero KPI principal (take first KPI if present) #}
						<div class="lg:col-span-5 bg-ms-light-black p-6 rounded-2xl flex flex-col justify-center" data-kpi-item>
							{% set main = section.kpis|first %}
							{% if main %}
								<div class="text-ms-gold font-display font-semibold leading-none text-[56px] md:text-[72px] lg:text-[96px]">
									<span data-kpi-value>{{ main.value }}</span>
								</div>
								{% if main.label %}
									<div class="mt-4 text-[16px] md:text-[18px] tracking-wide font-semibold text-ms-white">
										{{ main.label }}
									</div>
								{% endif %}
							{% endif %}
						</div>

						{# Right: grid of remaining KPIs #}
						<div class="lg:col-span-7">
							<ul class="grid grid-cols-2 gap-2 md:gap-6">
								{% for k in section.kpis|slice(1) %}
									<li class="p-4 bg-ms-light-black rounded-tl-3xl rounded-br-3xl rounded-lg" data-kpi-item>
										<div class="text-[28px] md:text-[44px] font-display font-bold text-ms-gold" data-kpi-value>{{ k.value }}</div>
										{% if k.label %}
											<div class="mt-2 text-[14px] md:text-[18px] text-ms-white/90">{{ k.label }}</div>
										{% endif %}
									</li>
								{% endfor %}
							</ul>
						</div>

					</div>
				</div>

			</div>
		</section>
	{% endif %}


	{#  5) LIEN DE PAGE #}
	{% if section.acf_fc_layout == 'lien_page' %}
		{% set buttons = section.bouton|default([]) %}

		{% if buttons|length %}
			<section class="py-8 lg:py-12">
				<div class="mx-auto max-w-7xl px-6">
					<div class="flex flex-col sm:flex-row items-center justify-center gap-4">

						{% for b in buttons %}
							{# page_link peut être URL (string), ID (string/int), ou parfois array #}
							{% set raw  = b.lien|default('') %}
							{% set href = (raw and raw.url) ? raw.url : raw %}
							{% set href = href ? (((href ~ '') matches '/^\\d+$/') ? fn('get_permalink', href) : href) : '' %}

							{% if href %}
								{# first button = inverse du bouton Contact; suivants = bouton Contact (ou comme section deux colonnes) #}
								{% set btn_inverse = 'inline-block bg-black text-ms-white py-2 px-6 rounded-lg font-semibold border-2 border-ms-gold hover:bg-ms-gold hover:text-black transition duration-300' %}
								{% set btn_contact = 'inline-block bg-ms-gold text-black py-2 px-6 rounded-lg font-semibold border-2 border-transparent hover:bg-black hover:text-ms-white hover:border-ms-gold transition duration-300' %}
								{% set btn_classes = (loop.index == 1) ? btn_inverse : btn_contact %}

								<a href="{{ href }}" class="{{ btn_classes }}" aria-label="{{ b.titre ?: 'En savoir plus' }}">
									<span class="flex items-center font-semibold tracking-wide">
										{{ b.titre ?: 'En savoir plus' }}
									</span>
								</a>
							{% endif %}
						{% endfor %}

					</div>
				</div>
			</section>
		{% endif %}
	{% endif %}

	{#  6) ENGAGEMENTS — modern cards with circular icons #}
	{% if section.acf_fc_layout == 'engagements' %}
		<section class="py-8 lg:py-12">
			<div class="container mx-auto px-6">
				{% if section.titre_engagement %}
					<h2 class="font-display text-[32px] lg:text-[48px] text-center mb-8">{{ section.titre_engagement }}</h2>
				{% endif %}
				{% if section.card_engagement and section.card_engagement|length %}
					<ul class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
						{% for card in section.card_engagement %}
							<li class="bg-ms-light-black/40 hover:bg-ms-light-black/60 rounded-tl-3xl rounded-tr-lg rounded-bl-lg rounded-br-3xl p-6 flex flex-col items-center text-center gap-3 transform transition-transform duration-300 hover:-translate-y-2 shadow-sm">
								<div class="w-20 h-20 rounded-full bg-gradient-to-tr from-ms-gold/10 to-ms-gold/20 flex items-center justify-center mb-2 overflow-hidden">
									{% if card.icone %}
										{# If ACF returned a full array/object with sizes #}
										{% if card.icone.sizes is defined %}
											{% set _src = (card.icone.sizes.medium_large ?? card.icone.sizes.medium ?? card.icone.url) %}
											{% set _alt = card.icone.alt|default(card.label|default('')) %}
											{# Fallback: ACF returned an attachment ID (int/string) - use WP functions #}
										{% else %}
											{% set _src = fn('wp_get_attachment_image_url', card.icone, 'medium_large') ?: fn('wp_get_attachment_image_url', card.icone, 'full') ?: '' %}
											{% set _alt = fn('get_post_meta', card.icone, '_wp_attachment_image_alt', true) ?: (card.label|default('')) %}
										{% endif %}

										{% if _src %}
											<img src="{{ _src }}" alt="{{ _alt }}" class="w-full h-full object-cover rounded-full" loading="lazy" decoding="async" fetchpriority="low">
										{% else %}
											<span class="w-full h-full bg-ms-gold rounded-full inline-block"></span>
										{% endif %}
									{% else %}
										<span class="w-full h-full bg-ms-gold rounded-full inline-block"></span>
									{% endif %}
								</div>
								{% if card.label %}
									<div class="font-semibold text-lg leading-tight">{{ card.label }}</div>
								{% endif %}
								{% if card.description %}
									<div class="text-ms-white/80 text-sm mt-2 max-w-[220px]">{{ card.description }}</div>
								{% endif %}
							</li>
						{% endfor %}
					</ul>
				{% endif %}
			</div>
		</section>
	{% endif %}

	{#  7) PROFILS #}
	{% if section.acf_fc_layout == 'profils' %}
		<section class="py-8 lg:py-12">
			<div class="container mx-auto px-6">
				{% if section.titre_profil %}
					<h2 class="font-display text-[32px] lg:text-[48px] text-center mb-24">{{ section.titre_profil }}</h2>
				{% endif %}
				{% if section.card_engagement and section.card_engagement|length %}
					<ul class="grid grid-cols-2 gap-8 justify-items-center">
						{% for card in section.card_engagement %}
							<li class="profil-card bg-ms-light-black/50 shadow-lg p-6 text-center relative overflow-visible pt-12 max-w-sm w-full rounded-tl-lg rounded-tr-3xl rounded-bl-3xl rounded-br-lg border-2 border-ms-gold">
								<div class="absolute -top-10 left-1/2 -translate-x-1/2">
									{% if card.image_profil %}
										<img src="{{ card.image_profil.url }}" alt="{{ card.image_profil.alt|default('') }}" class="w-24 h-24 object-cover rounded-full border-2 border-ms-gold shadow-md" loading="lazy">
									{% else %}
										<span class="w-24 h-24 inline-block rounded-full bg-ms-gold border-2 border-ms-gold"></span>
									{% endif %}
								</div>

								<div class="mt-8">
									{% if card.titre_card %}
										<h3 class="font-semibold text-xl mb-2">{{ card.titre_card }}</h3>
									{% endif %}
									{% if card.texte_card %}
										<p class="text-base text-ms-white/80">{{ card.texte_card }}</p>
									{% endif %}
								</div>
							</li>
						{% endfor %}
					</ul>
				{% endif %}
			</div>
		</section>
	{% endif %}


{% endfor %}
